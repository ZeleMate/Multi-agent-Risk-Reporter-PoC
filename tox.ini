[tox]
envlist = py311, py312, py313
skip_missing_interpreters = true

[testenv]
deps = -r pyproject.toml
setenv =
    OPENAI_API_KEY = sk-test-placeholder
    DEBUG_LOGS = false
    DATA_RAW = ./test_data/raw
    DATA_CLEAN = ./test_data/clean
    VECTORSTORE_DIR = ./test_vectorstore
    REPORT_DIR = ./test_reports
commands =
    python -m pytest tests/ -v --tb=short

[testenv:coverage]
deps =
    {[testenv]deps}
    coverage
setenv = {[testenv]setenv}
commands =
    coverage run -m pytest tests/ -v
    coverage report -m
    coverage html

[testenv:lint]
deps = -r pyproject.toml
commands =
    black --check src/ tests/ scripts/
    ruff check src/ tests/ scripts/
    mypy src/ --ignore-missing-imports
    bandit -r src/ -f json -o bandit-report.json || true

[testenv:fmt]
deps = -r pyproject.toml
commands =
    black src/ tests/ scripts/
    ruff check --fix src/ tests/ scripts/

[testenv:docs]
deps = -r pyproject.toml
commands =
    python -m pytest tests/ --doctest-modules --doctest-glob="*.md"
